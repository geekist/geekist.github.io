I"‡3<p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡ <a href="https://mazhuang.org/2020/05/01/cdn-for-github-pages/">ä½¿ç”¨ jsDelivr å…è´¹åŠ é€Ÿ GitHub Pages åšå®¢çš„é™æ€èµ„æº</a>ï¼Œåœ¨é‚£ä¹‹åï¼Œåˆé™†ç»­æƒ³åˆ°å¹¶å®æ–½äº†å‡ ç‚¹åˆ©ç”¨ jsDelivr è¿›ä¸€æ­¥åŠ é€Ÿé™æ€èµ„æºåŠ è½½çš„æªæ–½ï¼Œæ–°èµ·ä¸€ç¯‡ä½œä¸ºè®°å½•å’Œåˆ†äº«ã€‚</p>

<p>ç»§ä¸Šä¸€è½®æ”¹é€ è¿‡åï¼Œæ¯”è¾ƒæ‹–é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸»è¦æœ‰ä¸‰ç‚¹ï¼š</p>

<ol>
  <li>é¡µé¢é¦–ä¸ªè¯·æ±‚å“åº”æ—¶é—´ï¼›</li>
  <li>å›¾ç‰‡èµ„æºåŠ è½½æ—¶é—´ï¼›</li>
  <li>ç«™å†…æœç´¢å¼•ç”¨çš„ JSON èµ„æºåŠ è½½æ—¶é—´ã€‚</li>
</ol>

<p>ç¬¬ 1 ç‚¹åœ¨é¡µé¢ä»ç„¶æ‰˜ç®¡åœ¨ GitHub Pages çš„å‰æä¸‹ï¼Œä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå¥½åŠæ³•èƒ½äº§ç”Ÿè´¨çš„é£è·ƒï¼›æœ¬ç¯‡ä¸»è¦æ”¹å–„äº†ç¬¬ 2 ç‚¹å’Œç¬¬ 3 ç‚¹ã€‚</p>

<h2 id="0x01-å›¾ç‰‡èµ„æºåŠ é€Ÿ">0x01 å›¾ç‰‡èµ„æºåŠ é€Ÿ</h2>

<p>è¿™é‡Œæ‰€è¯´çš„å›¾ç‰‡ä¸»è¦æ˜¯æŒ‡æ–‡ç« é‡Œå¼•ç”¨çš„å›¾ç‰‡ã€‚</p>

<p>æˆ‘ä¸€ç›´å°†å›¾ç‰‡æ”¾åœ¨åšå®¢æºç æ ¹ç›®å½•çš„ images æ–‡ä»¶å¤¹ä¸‹ï¼Œå¼•ç”¨å›¾ç‰‡çš„ä¹ æƒ¯å†™æ³•æ˜¯è¿™æ ·çš„ï¼š</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">![</span><span class="nv">after use cdn</span><span class="p">](</span><span class="sx">/images/posts/github/cdn-after.png</span><span class="p">)</span>
</code></pre></div></div>

<p>å¦‚æœæƒ³å°†è¿™ä¸ªå›¾ç‰‡åœ°å€æ›¿æ¢ä¸º jsDelivr çš„åœ°å€ï¼Œéœ€è¦åšçš„å°±æ˜¯å°† <code class="language-plaintext highlighter-rouge">/images</code> æ›¿æ¢ä¸º <code class="language-plaintext highlighter-rouge">https://cdn.jsdelivr.net/gh/mzlogin/mzlogin.github.io@master/images</code>ã€‚</p>

<p>ä¸€å¤„ä¸€å¤„æ›¿æ¢è¡Œä¸è¡Œï¼Ÿå½“ç„¶ä¹Ÿè¡Œï¼Œä½†åé¢å†™æ–°æ–‡ç« æ—¶è¦å¼•ç”¨å›¾ç‰‡ï¼Œè¿˜å¾—æ‰‹åŠ¨å†™è¿™ä¸€é•¿ä¸²ï¼Œä¸æ–¹ä¾¿ï¼›ä¸‡ä¸€ jsDeliver å‡ºçŠ¶å†µï¼Œä¹Ÿä¸å¥½ä¸€é”®åˆ‡æ¢å›æ¥ã€‚æœ‰æ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼Ÿå½“ç„¶ä¹Ÿæœ‰ï¼Œæˆ‘ä»¬ä» Jekyll çš„ layout æœºåˆ¶æ¥æƒ³åŠæ³•ã€‚</p>

<p>Jekyll çš„ layout å¯ä»¥ç†è§£ä¸ºé¡µé¢æ¨¡æ¿ï¼Œå®ƒæ˜¯å¯ä»¥ç»§æ‰¿çš„ï¼Œæ¯”å¦‚æˆ‘çš„åšå®¢çš„æ‰€æœ‰é¡µé¢æ¨¡æ¿æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆæ¨¡æ¿ _layouts/default.htmlï¼Œæ¨¡æ¿é‡Œå¯ä»¥ä½¿ç”¨ <a href="https://github.com/Shopify/liquid/wiki/Liquid-for-Designers">Liquid</a> è¯­æ³•å¯¹å†…å®¹è¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ¥è‡ªåŠ¨å®Œæˆæ‰¹é‡æ›¿æ¢çš„å·¥ä½œã€‚</p>

<p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">assets_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">cdn</span><span class="p">.</span><span class="nv">jsdelivr</span><span class="p">.</span><span class="nv">enabled</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">assets_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://cdn.jsdelivr.net/gh/"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">repository</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="s1">'@master'</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">assets_images_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'src="'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="nv">assets_base_url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="s2">"/images"</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>header.html<span class="w"> </span><span class="p">%}</span>
    <span class="p">{{</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">replace</span><span class="p">:</span><span class="w"> </span><span class="s1">'src="/images'</span><span class="p">,</span><span class="w"> </span><span class="nv">assets_images_url</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>footer.html<span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<p>å¤§æ„å°±æ˜¯ï¼Œå¦‚æœæ‰“å¼€äº†å¯ç”¨ jsDelivr åŠ é€Ÿçš„å¼€å…³ï¼Œå°±å°† <code class="language-plaintext highlighter-rouge">content</code> é‡Œçš„ <code class="language-plaintext highlighter-rouge">src="/images"</code> æ›¿æ¢ä¸º <code class="language-plaintext highlighter-rouge">src="https://cdn.jsdelivr.net/gh/mzlogin/mzlogin.github.io@master/images"</code>ï¼Œå¦åˆ™æ›¿æ¢ä¸º <code class="language-plaintext highlighter-rouge">src="https://mazhuang.org/images"</code>ã€‚</p>

<p>ä»¥ä¸Šä¾¿è¾¾æˆäº†æˆ‘ä»¬çš„ç›®çš„ã€‚</p>

<h2 id="0x02-ç«™å†…æœç´¢å¼•ç”¨çš„-json-èµ„æºåŠ é€Ÿ">0x02 ç«™å†…æœç´¢å¼•ç”¨çš„ JSON èµ„æºåŠ é€Ÿ</h2>

<p>æˆ‘æ˜¯ä½¿ç”¨ <a href="https://github.com/christian-fei/Simple-Jekyll-Search">Simple-Jekyll-Search</a> è¿™ä¸ª JavaScript åº“æ¥å®ç°ç«™å†…æœç´¢çš„ï¼Œå®ƒçš„æœç´¢æ•°æ®æ˜¯æ¥è‡ªä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ JSON æ–‡ä»¶ã€‚</p>

<p>è¿™ä¸ª JSON æ–‡ä»¶ç¼–è¯‘å‰é•¿è¿™æ ·ï¼š</p>

<p><a href="https://github.com/mzlogin/mzlogin.github.io/blob/master/assets/search_data.json">https://github.com/mzlogin/mzlogin.github.io/blob/master/assets/search_data.json</a></p>

<p>Jekyll ç¼–è¯‘åé•¿è¿™æ ·ï¼š</p>

<p><a href="https://mazhuang.org/assets/search_data.json">https://mazhuang.org/assets/search_data.json</a></p>

<p>è¿™æ ·çš„èµ„æºæ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥é€šè¿‡æ›¿æ¢ç½‘å€æ¥ç”¨ jsDelivr åŠ é€Ÿçš„ï¼Œå› ä¸º jsDelivr ä¸Šç¼“å­˜çš„æ˜¯ç¼–è¯‘å‰çš„æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç¼–è¯‘åçš„ã€‚</p>

<p>é‚£æˆ‘ä»¬å°±æƒ³åŠæ³•ï¼š</p>

<ol>
  <li>å°†åšå®¢æºç ç¼–è¯‘ï¼›</li>
  <li>å°†ç¼–è¯‘ç»“æœä¿å­˜åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼›</li>
  <li>é€šè¿‡ jsDelivr å¼•ç”¨æ–°åˆ†æ”¯ä¸Šçš„è¿™ä¸ªæ–‡ä»¶ã€‚</li>
</ol>

<p>è¿™äº›æ­¥éª¤å¯ä»¥é€šè¿‡ GitHub å»å¹´æ¨å‡ºçš„æ–°ç‰¹æ€§ <a href="https://github.com/features/actions">Actions</a> æ¥å®Œæˆï¼Œåœ¨æˆ‘ä»¬æ¯ä¸€æ¬¡å‘åšå®¢æºç ä»“åº“ push ä»£ç æ—¶è‡ªåŠ¨è§¦å‘ã€‚</p>

<p>å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>åœ¨ GitHub æ–°å»ºä¸€ä¸ª Personal access Tokenï¼š</p>

    <p>Settings â€“&gt; Developer settings â€“&gt; Personal access tokens â€“&gt; Generate new token â€“&gt; å¡«å†™ noteï¼Œå‹¾é€‰ public_repoï¼Œç”Ÿæˆä¹‹åå¤åˆ¶ token å€¼å¤‡ç”¨ã€‚</p>
  </li>
  <li>
    <p>åœ¨åšå®¢æºç ä»“åº“çš„ Settings â€“&gt; Secrets â€“&gt; New secretï¼ŒName å¡« <code class="language-plaintext highlighter-rouge">ACCESS_TOKEN</code>ï¼ŒValue å¡«ç¬¬ 1 æ­¥é‡Œå¤åˆ¶çš„ token å€¼ï¼›</p>
  </li>
  <li>
    <p>åœ¨åšå®¢æºç æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ .github/workflows/ci.ymlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Deploy</span>

 <span class="na">on</span><span class="pi">:</span>
   <span class="na">push</span><span class="pi">:</span>
     <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">master</span> <span class="pi">]</span>

 <span class="na">jobs</span><span class="pi">:</span>
   <span class="na">build-and-deploy</span><span class="pi">:</span>
     <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
     <span class="na">steps</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout</span>
         <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2.3.1</span>
         <span class="na">with</span><span class="pi">:</span> 
           <span class="na">persist-credentials</span><span class="pi">:</span> <span class="no">false</span>

       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set Ruby </span><span class="m">2.7</span>
         <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-ruby@v1</span>
         <span class="na">with</span><span class="pi">:</span>
           <span class="na">ruby-version</span><span class="pi">:</span> <span class="m">2.7</span>

       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install and Build</span>
         <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
           <span class="s">gem install bundler</span>
           <span class="s">bundle install</span>
           <span class="s">bundle exec jekyll build</span>
           <span class="no"> </span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>
         <span class="na">uses</span><span class="pi">:</span> <span class="s">JamesIves/github-pages-deploy-action@3.6.2</span>
         <span class="na">with</span><span class="pi">:</span>
           <span class="na">ACCESS_TOKEN</span><span class="pi">:</span> <span class="s">$</span>
           <span class="na">BRANCH</span><span class="pi">:</span> <span class="s">built</span>
           <span class="na">FOLDER</span><span class="pi">:</span> <span class="s">_site</span>
           <span class="na">CLEAN</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div>    </div>

    <p>å¤§æ„å°±æ˜¯åœ¨å‘ master åˆ†æ”¯ push ä»£ç æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ checkoutã€åˆå§‹åŒ– ruby ç¯å¢ƒã€å®‰è£… Jekyll å¹¶ç¼–è¯‘åšå®¢æºç çš„å·¥ä½œï¼Œæœ€åå°†ç¼–è¯‘ç”Ÿæˆçš„ _site ç›®å½•é‡Œçš„å†…å®¹æ¨é€åˆ° built åˆ†æ”¯ã€‚å¯¹ GitHub Actions æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå‚è€ƒå®˜æ–¹è¯´æ˜å­¦ä¹ ã€‚</p>
  </li>
  <li>
    <p>ä¿®æ”¹å¼•ç”¨ JSON æ–‡ä»¶çš„åœ°æ–¹ï¼Œæ¯”å¦‚æˆ‘çš„ _includes/sidebar-search.html é‡Œçš„å†™æ³•ç”±ï¼š</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">json</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://mazhuang.org/assets/search_data.json</span><span class="dl">'</span><span class="p">,</span>
</code></pre></div>    </div>

    <p>æ”¹ä¸ºäº†</p>

    <div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">cdn</span><span class="p">.</span><span class="nv">jsdelivr</span><span class="p">.</span><span class="nv">enabled</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="ow">contains</span><span class="w"> </span><span class="s1">'mazhuang.org'</span><span class="w"> </span><span class="p">%}</span>
   json: 'https://cdn.jsdelivr.net/gh/mzlogin/mzlogin.github.io@built/assets/search_data.json',
 <span class="p">{%</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">%}</span>
   json: '<span class="p">{{</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">}}</span>/assets/search_data.json',
 <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å°†ä»¥ä¸Šæ›´æ”¹æ¨é€åˆ°æºç ä»“åº“ï¼Œç­‰å¾…å¤„ç†å®Œæˆå³å¯ã€‚</p>
  </li>
</ol>

<h2 id="0x03-ç»“è¯­">0x03 ç»“è¯­</h2>

<p>ç»è¿‡ä»¥ä¸Šæ”¹é€ ï¼Œåšå®¢é¡µé¢çš„åŠ è½½é€Ÿåº¦åˆå¾—åˆ°äº†å°å°çš„æå‡ï¼Œæ‰€æœ‰ç›¸å…³æºç å¯ä»¥åœ¨ <a href="https://github.com/mzlogin/mzlogin.github.io">https://github.com/mzlogin/mzlogin.github.io</a> æ‰¾åˆ°ï¼Œæœ‰ç›¸å…³å¿ƒå¾—æˆ–å»ºè®®çš„æœ‹å‹æ¬¢è¿äº¤æµæŒ‡æ­£ã€‚</p>

<p>ç›¸å…³æ–‡ç« ï¼š</p>

<ul>
  <li><a href="https://mazhuang.org/2020/05/01/cdn-for-github-pages/">ä½¿ç”¨ jsDelivr å…è´¹åŠ é€Ÿ GitHub Pages åšå®¢çš„é™æ€èµ„æº</a></li>
</ul>
:ET