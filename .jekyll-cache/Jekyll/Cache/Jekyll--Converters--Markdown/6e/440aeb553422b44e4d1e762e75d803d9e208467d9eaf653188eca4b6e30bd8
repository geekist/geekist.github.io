I"$<p>åŸºäºé˜¿é‡Œäº‘CESæœåŠ¡å™¨å’ŒNginx-1.75.5é…ç½®SSLè¯ä¹¦çš„æ­¥éª¤</p>

<h2 id="step1ä¸‹è½½sslè¯ä¹¦åˆ°æœ¬åœ°">step1ï¼šä¸‹è½½sslè¯ä¹¦åˆ°æœ¬åœ°ã€‚</h2>
<p>ç™»å½•sslè¯ä¹¦æ§åˆ¶å°ã€‚
åœ¨æ¦‚è§ˆé¡µé¢ï¼Œå•å‡»è¯ä¹¦åˆ—è¡¨ä¸Šæ–¹çš„è¯ä¹¦çŠ¶æ€ä¸‹æ‹‰åˆ—è¡¨ï¼Œé€‰æ‹©å·²ç­¾å‘ã€‚
å•å‡»ä¸‹è½½ï¼Œå®šä½NginxæœåŠ¡å™¨ï¼Œå•å‡»ä¸‹è½½ã€‚å¯ä»¥å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼šcert-file-name.pemå’Œcert-file-name.key</p>

<h2 id="step2åœ¨nginxç‹¬ç«‹æœåŠ¡å™¨ä¸Šå®‰è£…è¯ä¹¦">step2ï¼šåœ¨Nginxç‹¬ç«‹æœåŠ¡å™¨ä¸Šå®‰è£…è¯ä¹¦ã€‚</h2>

<p>1ã€ç™»å½•NginxæœåŠ¡å™¨ï¼Œ
è¿™é‡Œé€‰æ‹©äº†MobaXtermå·¥å…·ï¼Œæ‰“å¼€MobaXtermï¼Œé€‰æ‹©sessionsâ€”&gt;new session è¿›å…¥session settingsé¡µé¢ï¼Œé€‰æ‹©SSHå¹¶è®¾ç½®Remote hostå’ŒSpecify usernameã€‚</p>

<p>2ã€ä¸Šä¼ è¯ä¹¦æ–‡ä»¶åˆ°/usr/local/nginx/confç›®å½•ã€‚
è¿è¡Œ cd /usr/local/nginx/conf ä½¿ç”¨å·¥å…·å°†æ–‡ä»¶ä¸Šä¼ åˆ°è¯¥ç›®å½•</p>

<p>3ã€ç¼–è¾‘Nginxçš„é…ç½®æ–‡ä»¶nginx.conf,ä¿®æ”¹ä¸è¯ä¹¦ç›¸å…³çš„é…ç½®å†…å®¹ã€‚
vim /usr/local/nginx/conf/nginx.conf
ié”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œ
æ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span> <span class="o">{</span>
    <span class="n">listen</span> <span class="mi">443</span> <span class="n">ssl</span><span class="o">;</span>
    <span class="err">#</span><span class="n">é…ç½®HTTPSçš„é»˜è®¤è®¿é—®ç«¯å£ä¸º443</span><span class="err">ã€‚</span>
    <span class="err">#</span><span class="n">å¦‚æœæœªåœ¨æ­¤å¤„é…ç½®HTTPSçš„é»˜è®¤è®¿é—®ç«¯å£</span><span class="err">ï¼Œ</span><span class="n">å¯èƒ½ä¼šé€ æˆNginxæ— æ³•å¯åŠ¨</span><span class="err">ã€‚</span>
    <span class="err">#</span><span class="n">å¦‚æœæ‚¨ä½¿ç”¨Nginx</span> <span class="mf">1.15</span><span class="o">.</span><span class="mi">0</span><span class="n">åŠä»¥ä¸Šç‰ˆæœ¬</span><span class="err">ï¼Œ</span><span class="n">è¯·ä½¿ç”¨listen</span> <span class="mi">443</span> <span class="n">sslä»£æ›¿listen</span> <span class="mi">443</span><span class="n">å’Œssl</span> <span class="n">on</span><span class="err">ã€‚</span>
    <span class="n">server_name</span> <span class="n">yourdomain</span><span class="o">.</span><span class="na">com</span><span class="o">;</span> <span class="err">#</span><span class="n">éœ€è¦å°†yourdomain</span><span class="o">.</span><span class="na">comæ›¿æ¢æˆè¯ä¹¦ç»‘å®šçš„åŸŸå</span><span class="err">ã€‚</span>
    <span class="n">root</span> <span class="n">html</span><span class="o">;</span>
    <span class="n">index</span> <span class="n">index</span><span class="o">.</span><span class="na">html</span> <span class="n">index</span><span class="o">.</span><span class="na">htm</span><span class="o">;</span>
    <span class="n">ssl_certificate</span> <span class="n">cert</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="na">pem</span><span class="o">;</span>  <span class="err">#</span><span class="n">éœ€è¦å°†cert</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="na">pemæ›¿æ¢æˆå·²ä¸Šä¼ çš„è¯ä¹¦æ–‡ä»¶çš„åç§°</span><span class="err">ã€‚</span>
    <span class="n">ssl_certificate_key</span> <span class="n">cert</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="na">key</span><span class="o">;</span> <span class="err">#</span><span class="n">éœ€è¦å°†cert</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="na">keyæ›¿æ¢æˆå·²ä¸Šä¼ çš„è¯ä¹¦å¯†é’¥æ–‡ä»¶çš„åç§°</span><span class="err">ã€‚</span>
    <span class="n">ssl_session_timeout</span> <span class="mi">5</span><span class="n">m</span><span class="o">;</span>
    <span class="n">ssl_ciphers</span> <span class="no">ECDHE</span><span class="o">-</span><span class="no">RSA</span><span class="o">-</span><span class="no">AES128</span><span class="o">-</span><span class="no">GCM</span><span class="o">-</span><span class="nl">SHA256:ECDHE:ECDH:AES:HIGH:</span><span class="o">!</span><span class="nl">NULL:</span><span class="o">!</span><span class="nl">aNULL:</span><span class="o">!</span><span class="nl">MD5:</span><span class="o">!</span><span class="nl">ADH:</span><span class="o">!</span><span class="no">RC4</span><span class="o">;</span>
    <span class="err">#</span><span class="n">è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹</span><span class="err">ã€‚</span>
    <span class="n">ssl_protocols</span> <span class="nc">TLSv1</span> <span class="nc">TLSv1</span><span class="o">.</span><span class="mi">1</span> <span class="nc">TLSv1</span><span class="o">.</span><span class="mi">2</span><span class="o">;</span> <span class="err">#</span><span class="n">è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹</span><span class="err">ã€‚</span>
    <span class="n">ssl_prefer_server_ciphers</span> <span class="n">on</span><span class="o">;</span>
    <span class="n">location</span> <span class="o">/</span> <span class="o">{</span>
        <span class="n">root</span> <span class="n">html</span><span class="o">;</span>  <span class="err">#</span><span class="n">ç«™ç‚¹ç›®å½•</span><span class="err">ã€‚</span>
        <span class="n">index</span> <span class="n">index</span><span class="o">.</span><span class="na">html</span> <span class="n">index</span><span class="o">.</span><span class="na">htm</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<p>å¯é€‰é…ç½®ï¼š
å¯é€‰ï¼šè®¾ç½®HTTPè¯·æ±‚è‡ªåŠ¨è·³è½¬HTTPSã€‚
å¦‚æœæ‚¨å¸Œæœ›æ‰€æœ‰çš„HTTPè®¿é—®è‡ªåŠ¨è·³è½¬åˆ°HTTPSé¡µé¢ï¼Œåˆ™å¯ä»¥åœ¨éœ€è¦è·³è½¬çš„HTTPç«™ç‚¹ä¸‹æ·»åŠ ä»¥ä¸‹rewriteè¯­å¥ã€‚
ä½¿ç”¨ç¤ºä¾‹ä»£ç å‰ï¼Œè¯·æ³¨æ„å°†yourdomain.comæ›¿æ¢æˆè¯ä¹¦ç»‘å®šçš„åŸŸåã€‚</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span> <span class="o">{</span>
    <span class="n">listen</span> <span class="mi">80</span><span class="o">;</span>
    <span class="n">server_name</span> <span class="n">yourdomain</span><span class="o">.</span><span class="na">com</span><span class="o">;</span> <span class="err">#</span><span class="n">éœ€è¦å°†yourdomain</span><span class="o">.</span><span class="na">comæ›¿æ¢æˆè¯ä¹¦ç»‘å®šçš„åŸŸå</span><span class="err">ã€‚</span>
    <span class="n">rewrite</span> <span class="o">^(.*)</span><span class="err">$</span> <span class="nl">https:</span><span class="c1">//$host$1; #å°†æ‰€æœ‰HTTPè¯·æ±‚é€šè¿‡rewriteæŒ‡ä»¤é‡å®šå‘åˆ°HTTPSã€‚</span>
    <span class="n">location</span> <span class="o">/</span> <span class="o">{</span>
        <span class="n">index</span> <span class="n">index</span><span class="o">.</span><span class="na">html</span> <span class="n">index</span><span class="o">.</span><span class="na">htm</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>æŒ‰escé€€å›ï¼Œ:wq! ä¿å­˜è¯¥æ–‡ä»¶ã€‚</p>

<p>4ã€é‡å¯NginxæœåŠ¡ã€‚</p>

<p>cd /usr/local/nginx/sbin  #è¿›å…¥NginxæœåŠ¡çš„å¯æ‰§è¡Œç›®å½•ã€‚
./nginx -s reload  #é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶ã€‚</p>

<p>5ã€é”™è¯¯å¤„ç†
Nginxå¦‚æœæœªå¼€å¯SSLæ¨¡å—ï¼Œé…ç½®Httpsæ—¶æç¤ºé”™è¯¯â€œnginx: [emerg] the â€œsslâ€ parameter requires ngx_http_ssl_module in /usr/local/nginx/conf/nginx.conf:37â€</p>

<p>åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œnginxç¼ºå°‘http_ssl_moduleæ¨¡å—ï¼Œç¼–è¯‘å®‰è£…çš„æ—¶å€™å¸¦ä¸Šâ€“with-http_ssl_moduleé…ç½®å°±è¡Œäº†ï¼Œå¦‚æœå·²ç»å®‰è£…å¥½äº†Nginxï¼Œåˆ™å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥é…ç½®sslï¼š</p>

<p>åˆ‡æ¢åˆ°æºç åŒ…ï¼š
cd /usr/local/src/nginx-1.11.3</p>

<p>æŸ¥çœ‹nginxåŸæœ‰çš„æ¨¡å—</p>

<p>/usr/local/nginx/sbin/nginx -V</p>

<p>åœ¨configure arguments:åé¢æ˜¾ç¤ºçš„åŸæœ‰çš„configureå‚æ•°å¦‚ä¸‹ï¼š</p>

<p>â€“prefix=/usr/local/nginx â€“with-http_stub_status_module</p>

<p>é‚£ä¹ˆæˆ‘ä»¬çš„æ–°é…ç½®ä¿¡æ¯å°±åº”è¯¥è¿™æ ·å†™ï¼š</p>

<p>./configure â€“prefix=/usr/local/nginx â€“with-http_stub_status_module â€“with-http_ssl_module</p>

<p>å›è½¦ï¼Œç­‰å¾…é…ç½®å®Œæˆåï¼Œè¿è¡Œå‘½ä»¤</p>

<p>make</p>

<p>è¿™é‡Œä¸è¦è¿›è¡Œmake installï¼Œå¦åˆ™å°±æ˜¯è¦†ç›–å®‰è£…</p>

<p>ç„¶åå¤‡ä»½åŸæœ‰å·²å®‰è£…å¥½çš„nginx</p>

<p>cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak</p>

<p>åœæ­¢Nginxï¼š
åœæ­¢æ“ä½œ
åœæ­¢æ“ä½œæ˜¯é€šè¿‡å‘nginxè¿›ç¨‹å‘é€ä¿¡å·æ¥è¿›è¡Œçš„</p>

<p>æ­¥éª¤1ï¼šæŸ¥è¯¢nginxä¸»è¿›ç¨‹å·</p>

<p>ps -ef | grep nginx
åœ¨è¿›ç¨‹åˆ—è¡¨é‡Œ é¢æ‰¾masterè¿›ç¨‹ï¼Œå®ƒçš„ç¼–å·å°±æ˜¯ä¸»è¿›ç¨‹å·äº†ã€‚</p>

<p>ä»å®¹åœæ­¢Nginxï¼š
kill -QUIT ä¸»è¿›ç¨‹å·<br />
ä¾‹å¦‚ï¼škill -QUIT 16391</p>

<p>å¿«é€Ÿåœæ­¢Nginxï¼š
kill -TERM ä¸»è¿›ç¨‹å·</p>

<p>å¼ºåˆ¶åœæ­¢Nginxï¼š
kill -9 ä¸»è¿›ç¨‹å·</p>

<p>ç„¶åå°†åˆšåˆšç¼–è¯‘å¥½çš„nginxè¦†ç›–æ‰åŸæœ‰çš„nginxï¼ˆè¿™ä¸ªæ—¶å€™nginxè¦åœæ­¢çŠ¶æ€ï¼‰</p>

<p>cp ./objs/nginx /usr/local/nginx/sbin/</p>

<p>ç„¶åå¯åŠ¨nginx
nginx -c /usr/local/nginx/conf/nginx.conf</p>

<p>ä»å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å·²ç»åŠ å…¥æˆåŠŸ</p>

<p>/usr/local/nginx/sbin/nginx -V</p>

:ET