I"ãµ<p>æœ¬ç³»åˆ—æ–‡ç« åœ¨ <a href="https://github.com/mzlogin/rtfsc-android">https://github.com/mzlogin/rtfsc-android</a> æŒ(jing)ç»­(chang)æ›´(duan)æ–°(geng)ä¸­ï¼Œæ¬¢è¿æœ‰å…´è¶£çš„ç«¥é‹ä»¬å…³æ³¨ã€‚</p>

<p>ä¹¦æ¥ä¸Šæ–‡ï¼Œåœ¨åˆ†æ Toast æºç çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬æ¶‰åŠåˆ°äº† Handlerï¼Œè¿™ä¸ªåœ¨ Android å¼€å‘é‡Œç»å¸¸ç”¨åˆ°çš„ç±»â€”â€”çº¿ç¨‹åˆ‡æ¢ã€é¡ºåºæ‰§è¡Œã€å»¶æ—¶æ‰§è¡Œç­‰ç­‰é€»è¾‘é‡Œå¾€å¾€å°‘ä¸äº†å®ƒçš„èº«å½±ï¼Œè·Ÿå®ƒä¸€èµ·æ­é…ä½¿ç”¨çš„é€šå¸¸æ˜¯ Runnable å’Œ Messageï¼Œè¿˜æœ‰å®ƒèº«åçš„å¥½åŸºå‹ Looper ä¸ MessageQueueã€‚Runnable ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œæœ¬æ–‡çš„ä¸»è§’å°±æ˜¯æ ‡é¢˜é‡Œçš„ä¸‰å‰‘å®¢â€”â€”Handlerã€Looper å’Œ MessageQueueï¼Œå½“ç„¶å°‘ä¸äº†è¯´åˆ° Messageã€‚</p>

<p>æœ¬æ–‡ä½¿ç”¨çš„å·¥å…·ä¸æºç ä¸ºï¼šChromeã€æ’ä»¶ insight.ioã€GitHub é¡¹ç›® <a href="https://github.com/aosp-mirror/platform_frameworks_base">aosp-mirror/platform_frameworks_base</a></p>

<p><strong>ç›®å½•</strong></p>

<ul id="markdown-toc">
  <li><a href="#åˆæ­¥å°è±¡" id="markdown-toc-åˆæ­¥å°è±¡">åˆæ­¥å°è±¡</a>    <ul>
      <li><a href="#handler" id="markdown-toc-handler">Handler</a></li>
      <li><a href="#looper" id="markdown-toc-looper">Looper</a></li>
      <li><a href="#messagequeue" id="markdown-toc-messagequeue">MessageQueue</a></li>
      <li><a href="#message" id="markdown-toc-message">Message</a></li>
    </ul>
  </li>
  <li><a href="#æå‡ºé—®é¢˜" id="markdown-toc-æå‡ºé—®é¢˜">æå‡ºé—®é¢˜</a></li>
  <li><a href="#è§£ç­”é—®é¢˜" id="markdown-toc-è§£ç­”é—®é¢˜">è§£ç­”é—®é¢˜</a>    <ul>
      <li><a href="#thread-ä¸-looper" id="markdown-toc-thread-ä¸-looper">Thread ä¸ Looper</a></li>
      <li><a href="#looper-ä¸-messagequeue" id="markdown-toc-looper-ä¸-messagequeue">Looper ä¸ MessageQueue</a></li>
      <li><a href="#handler-ä¸-looper" id="markdown-toc-handler-ä¸-looper">Handler ä¸ Looper</a></li>
      <li><a href="#æ¶ˆæ¯å¦‚ä½•åˆ†å‘åˆ°å¯¹åº”çš„-handler" id="markdown-toc-æ¶ˆæ¯å¦‚ä½•åˆ†å‘åˆ°å¯¹åº”çš„-handler">æ¶ˆæ¯å¦‚ä½•åˆ†å‘åˆ°å¯¹åº”çš„ Handler</a></li>
      <li><a href="#handler-èƒ½ç”¨äºçº¿ç¨‹åˆ‡æ¢çš„åŸç†" id="markdown-toc-handler-èƒ½ç”¨äºçº¿ç¨‹åˆ‡æ¢çš„åŸç†">Handler èƒ½ç”¨äºçº¿ç¨‹åˆ‡æ¢çš„åŸç†</a></li>
      <li><a href="#runnable-ä¸-messagequeue" id="markdown-toc-runnable-ä¸-messagequeue">Runnable ä¸ MessageQueue</a></li>
      <li><a href="#èƒ½å¦åˆ›å»ºå…³è”åˆ°å…¶å®ƒçº¿ç¨‹çš„-handler" id="markdown-toc-èƒ½å¦åˆ›å»ºå…³è”åˆ°å…¶å®ƒçº¿ç¨‹çš„-handler">èƒ½å¦åˆ›å»ºå…³è”åˆ°å…¶å®ƒçº¿ç¨‹çš„ Handler</a></li>
      <li><a href="#æ¶ˆæ¯å¯ä»¥æ’é˜Ÿå—" id="markdown-toc-æ¶ˆæ¯å¯ä»¥æ’é˜Ÿå—">æ¶ˆæ¯å¯ä»¥æ’é˜Ÿå—</a></li>
      <li><a href="#æ¶ˆæ¯å¯ä»¥æ’¤å›å—" id="markdown-toc-æ¶ˆæ¯å¯ä»¥æ’¤å›å—">æ¶ˆæ¯å¯ä»¥æ’¤å›å—</a></li>
      <li><a href="#æ‰¾åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯æºç " id="markdown-toc-æ‰¾åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯æºç ">æ‰¾åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯æºç </a></li>
    </ul>
  </li>
  <li><a href="#æ€»ç»“" id="markdown-toc-æ€»ç»“">æ€»ç»“</a>    <ul>
      <li><a href="#ç»“è®ºæ±‡æ€»" id="markdown-toc-ç»“è®ºæ±‡æ€»">ç»“è®ºæ±‡æ€»</a></li>
      <li><a href="#é—ç•™çŸ¥è¯†ç‚¹" id="markdown-toc-é—ç•™çŸ¥è¯†ç‚¹">é—ç•™çŸ¥è¯†ç‚¹</a></li>
      <li><a href="#æœ¬ç¯‡ç”¨åˆ°çš„æºç åˆ†ææ–¹æ³•" id="markdown-toc-æœ¬ç¯‡ç”¨åˆ°çš„æºç åˆ†ææ–¹æ³•">æœ¬ç¯‡ç”¨åˆ°çš„æºç åˆ†ææ–¹æ³•</a></li>
    </ul>
  </li>
  <li><a href="#åè¯" id="markdown-toc-åè¯">åè¯</a></li>
</ul>

<h2 id="åˆæ­¥å°è±¡">åˆæ­¥å°è±¡</h2>

<p>æŒ‰æƒ¯ä¾‹ï¼Œç¬¬ä¸€æ­¥è¿˜æ˜¯ä» Android çš„å®˜æ–¹ API æ–‡æ¡£é‡Œæ¥å»ºç«‹å¯¹è¿™å‡ ä¸ªç±»çš„åˆæ­¥å°è±¡ï¼Œæ–‡æ¡£å¼€å¤´çš„è¯´æ˜é‡Œå¾€å¾€æœ‰ä¸€äº›æ¯”è¾ƒå…³é”®çš„çŸ¥è¯†ç‚¹ã€‚</p>

<p>å®˜æ–¹æ–‡æ¡£é“¾æ¥ï¼š</p>

<ul>
  <li><a href="https://developer.android.google.cn/reference/android/os/Handler">Handler</a></li>
  <li><a href="https://developer.android.google.cn/reference/android/os/Looper">Looper</a></li>
  <li><a href="https://developer.android.google.cn/reference/android/os/MessageQueue">MessageQueue</a></li>
  <li><a href="https://developer.android.google.cn/reference/android/os/Message">Message</a></li>
</ul>

<p>è¿™å‡ ä¸ªç±»å¼€å¤´çš„è¯´æ˜æœ¬èº«ä¹Ÿä¸é•¿ï¼Œä¸ºäº†é¿å…æ–­ç« å–ä¹‰è¯¯äººå­å¼Ÿï¼Œå°±å°†å…¶ç›´è¯‘ç‰ˆå®Œæ•´åœ°æ”¾åœ¨ä¸‹é¢ï¼Œå½“ç„¶æ›´æ¨èçš„æ–¹å¼æ˜¯è‡ªå·±å»çœ‹åŸæ–‡ã€‚</p>

<h3 id="handler">Handler</h3>

<p>å¯ä»¥ç”¨ Handler å‘é€å’Œå¤„ç†ä¸æŸçº¿ç¨‹çš„ MessageQueue ç›¸å…³è”çš„ Message/Runnable å¯¹è±¡ã€‚æ¯ä¸ª Handler å®ä¾‹åªèƒ½ä¸ä¸€ä¸ªçº¿ç¨‹å’Œå®ƒçš„æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³è”ã€‚å½“åˆ›å»ºä¸€ä¸ª Handler æ—¶ï¼Œå®ƒä¼šç»‘å®šåˆ°å½“å‰çº¿ç¨‹å’Œæ¶ˆæ¯é˜Ÿåˆ—â€”â€”ä»é‚£æ—¶èµ·ï¼Œå®ƒå°† Message å’Œ Runnable ä¼ é€’ç»™ç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶åœ¨å®ƒä»¬ä»é˜Ÿåˆ—é‡Œè¢«å–å‡ºæ—¶æ‰§è¡Œå¯¹åº”é€»è¾‘ã€‚ï¼ˆ<em>è¯‘æ³¨ï¼šæ­¤å¤„æè¿°ä¸å‡†ç¡®ï¼Œåˆ›å»º Handler æ—¶å¹¶ä¸ä¸€å®šæ˜¯ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ã€‚</em>ï¼‰</p>

<p>Handler ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š</p>

<ol>
  <li>
    <p>åœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹å¤„ç† Messages æˆ–è€…æ‰§è¡Œ Runnablesï¼›</p>
  </li>
  <li>
    <p>å°†ä¸€æ®µé€»è¾‘åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p>
  </li>
</ol>

<p>å¯ä»¥ä½¿ç”¨ Handler çš„ä»¥ä¸‹æ–¹æ³•æ¥è°ƒåº¦ Messages å’Œ Runnablesï¼š</p>

<ul>
  <li>
    <p>post(Runnable)</p>
  </li>
  <li>
    <p>postAtTime(Runnable, long)</p>
  </li>
  <li>
    <p>postDelayed(Runnable, Object, long)</p>
  </li>
  <li>
    <p>sendEmptyMessage(int)</p>
  </li>
  <li>
    <p>sendMessage(Message)</p>
  </li>
  <li>
    <p>sendMessageAtTime(Message, long)</p>
  </li>
  <li>
    <p>sendMessageDelayed(Message, long)</p>
  </li>
</ul>

<p>å…¶ä¸­ postXXX ç³»åˆ—ç”¨äºå°† Runnable å¯¹è±¡åŠ å…¥é˜Ÿåˆ—ï¼ŒsendXXX ç³»åˆ—ç”¨äºå°† Message å¯¹è±¡åŠ å…¥é˜Ÿåˆ—ï¼ŒMessage å¯¹è±¡é€šå¸¸ä¼šæºå¸¦ä¸€äº›æ•°æ®ï¼Œå¯ä»¥åœ¨ Handler çš„ handlerMessage(Message) æ–¹æ³•ä¸­å¤„ç†ï¼ˆéœ€è¦å®ç°ä¸€ä¸ª Handler å­ç±»ï¼‰ã€‚</p>

<p>åœ¨è°ƒç”¨ Handler çš„ postXXX å’Œ sendXXX æ—¶ï¼Œå¯ä»¥æŒ‡å®šå½“é˜Ÿåˆ—å‡†å¤‡å¥½æ—¶ç«‹å³å¤„ç†å®ƒä»¬ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå»¶æ—¶ä¸€æ®µæ—¶é—´åå¤„ç†ï¼Œæˆ–æŸä¸ªç»å¯¹æ—¶é—´ç‚¹å¤„ç†ã€‚åé¢è¿™ä¸¤ç§èƒ½å®ç°è¶…æ—¶ã€å»¶æ—¶ã€å‘¨æœŸå¾ªç¯åŠå…¶å®ƒåŸºäºæ—¶é—´çš„è¡Œä¸ºã€‚</p>

<p>ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå…¶ä¸»çº¿ç¨‹ä¸“ç”¨äºè¿è¡Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—è´Ÿè´£ç®¡ç†é¡¶å±‚åº”ç”¨ç¨‹åºå¯¹è±¡ï¼ˆactivitiesï¼Œbroadcast receivers ç­‰ï¼‰ä»¥åŠå®ƒä»¬åˆ›å»ºçš„çª—å£ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„çº¿ç¨‹ï¼Œç„¶åé€šè¿‡ Handler ä¸ä¸»çº¿ç¨‹è¿›è¡Œé€šä¿¡ï¼Œæ–¹æ³•æ˜¯ä»æ–°çº¿ç¨‹è°ƒç”¨æˆ‘ä»¬å‰é¢è®²åˆ°çš„ postXXX æˆ– sendXXX æ–¹æ³•ï¼Œä¼ é€’çš„ Runnable æˆ– Message å°†è¢«åŠ å…¥ Handler å…³è”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶é€‚æ—¶è¿›è¡Œå¤„ç†ã€‚</p>

<h3 id="looper">Looper</h3>

<p>ç”¨äºä¸ºçº¿ç¨‹æ‰§è¡Œæ¶ˆæ¯å¾ªç¯çš„ç±»ã€‚çº¿ç¨‹é»˜è®¤æ²¡æœ‰å…³è”çš„æ¶ˆæ¯å¾ªç¯ï¼Œå¦‚æœè¦åˆ›å»ºä¸€ä¸ªï¼Œå¯ä»¥åœ¨æ‰§è¡Œæ¶ˆæ¯å¾ªç¯çš„çº¿ç¨‹é‡Œé¢è°ƒç”¨ prepare() æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ loop() å¤„ç†æ¶ˆæ¯ï¼Œç›´åˆ°å¾ªç¯åœæ­¢ã€‚</p>

<p>å¤§å¤šæ•°ä¸æ¶ˆæ¯å¾ªç¯çš„äº¤äº’éƒ½æ˜¯é€šè¿‡ Handler ç±»ã€‚</p>

<p>ä¸‹é¢æ˜¯å®ç°ä¸€ä¸ª Looper çº¿ç¨‹çš„å…¸å‹ä¾‹å­ï¼Œåœ¨ prepare() å’Œ loop() ä¹‹é—´åˆå§‹åŒ– Handler å®ä¾‹ï¼Œç”¨äºä¸ Looper é€šä¿¡ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">LooperThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Handler</span> <span class="n">mHandler</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Looper</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>

        <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// åœ¨è¿™é‡Œå¤„ç†ä¼ å…¥çš„æ¶ˆæ¯</span>
            <span class="o">}</span>
        <span class="o">};</span>

        <span class="nc">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="messagequeue">MessageQueue</h3>

<p>æŒæœ‰å°†è¢« Looper åˆ†å‘çš„æ¶ˆæ¯åˆ—è¡¨çš„åº•å±‚ç±»ã€‚æ¶ˆæ¯éƒ½æ˜¯é€šè¿‡ä¸ Looper å…³è”çš„ Handler æ·»åŠ åˆ° MessageQueueï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œ MessageQueueã€‚</p>

<p>å¯ä»¥ç”¨ Looper.myQueue() è·å–å½“å‰çº¿ç¨‹çš„ MessageQueue å®ä¾‹ã€‚</p>

<h3 id="message">Message</h3>

<p>å®šä¹‰ä¸€ä¸ªå¯ä»¥å‘é€ç»™ Handler çš„æ¶ˆæ¯ï¼ŒåŒ…å«æè¿°å’Œä»»æ„æ•°æ®å¯¹è±¡ã€‚æ¶ˆæ¯å¯¹è±¡æœ‰ä¸¤ä¸ªé¢å¤–çš„ int å­—æ®µå’Œä¸€ä¸ª object å­—æ®µï¼Œè¿™å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯çš„éœ€æ±‚äº†ã€‚</p>

<blockquote>
  <p>è™½ç„¶ Message çš„æ„é€ æ–¹æ³•æ˜¯ public çš„ï¼Œä½†æœ€æ¨èçš„å¾—åˆ°ä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡çš„æ–¹å¼æ˜¯è°ƒç”¨ Message.obtain() æˆ–è€… Handler.obtainMessage() ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šä»ä¸€ä¸ªå¯¹è±¡å›æ”¶æ± é‡Œæ¡å›èƒ½å¤ç”¨çš„å¯¹è±¡ã€‚</p>
</blockquote>

<h2 id="æå‡ºé—®é¢˜">æå‡ºé—®é¢˜</h2>

<p>æ ¹æ®ä»¥ä¸Šå°è±¡ï¼ŒåŠä»¥å‰çš„ä½¿ç”¨ç»éªŒï¼Œæå‡ºä»¥ä¸‹é—®é¢˜æ¥ç»§ç»­æœ¬æ¬¡æºç åˆ†æä¹‹æ—…ï¼š</p>

<ol>
  <li>
    <p>Thread ä¸ Looperï¼ŒLooper ä¸ MessageQueueï¼ŒHandler ä¸ Looper ä¹‹é—´çš„æ•°é‡å¯¹åº”å…³ç³»æ˜¯æ€æ ·çš„ï¼Ÿ</p>
  </li>
  <li>
    <p>å¦‚æœ Looper èƒ½å¯¹åº”å¤šä¸ª Handlerï¼Œé‚£é€šè¿‡ä¸åŒçš„ Handler å‘é€çš„ Messageï¼Œé‚£å¤„ç†çš„æ—¶å€™ä»£ç æ˜¯å¦‚ä½•çŸ¥é“è¯¥åˆ†å‘åˆ°å“ªä¸€ä¸ª Handler çš„ handlerMessage æ–¹æ³•çš„ï¼Ÿ</p>
  </li>
  <li>
    <p>Handler èƒ½ç”¨äºçº¿ç¨‹åˆ‡æ¢çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
  </li>
  <li>
    <p>Runnable å¯¹è±¡ä¹Ÿæ˜¯è¢«æ·»åŠ åˆ° MessageQueue é‡Œå—ï¼Ÿ</p>
  </li>
  <li>
    <p>å¯ä»¥åœ¨ A çº¿ç¨‹åˆ›å»º Handler å…³è”åˆ° B çº¿ç¨‹åŠå…¶æ¶ˆæ¯å¾ªç¯å—ï¼Ÿ</p>
  </li>
  <li>
    <p>å¦‚ä½•é€€å‡ºæ¶ˆæ¯å¾ªç¯ï¼Ÿ</p>
  </li>
  <li>
    <p>æ¶ˆæ¯å¯ä»¥æ’é˜Ÿå—ï¼Ÿ</p>
  </li>
  <li>
    <p>æ¶ˆæ¯å¯ä»¥æ’¤å›å—ï¼Ÿ</p>
  </li>
  <li>
    <p>ä¸Šæ–‡æåˆ°ï¼Œåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹æ˜¯è¿è¡Œä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œåœ¨ä»£ç é‡Œæ˜¯å¦‚ä½•åæ˜ çš„ï¼Ÿ</p>
  </li>
</ol>

<h2 id="è§£ç­”é—®é¢˜">è§£ç­”é—®é¢˜</h2>

<h3 id="thread-ä¸-looper">Thread ä¸ Looper</h3>

<p>å‰æ–‡æœ‰æåˆ°ï¼Œçº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰æ¶ˆæ¯å¾ªç¯çš„ï¼Œéœ€è¦è°ƒç”¨ Looper.prepare() æ¥è¾¾åˆ°ç›®çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹è¿™ä¸ªé—®é¢˜çš„æ¢ç´¢å°±ä» Looper.prepare() å¼€å§‹ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** Initialize the current thread as a looper.
 * This gives you a chance to create handlers that then reference
 * this looper, before actually starting the loop. Be sure to call
 * {@link #loop()} after calling this method, and end it by calling
 * {@link #quit()}.
 */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">prepare</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">quitAllowed</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Only one Looper may be created per thread"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="nc">Looper</span><span class="o">(</span><span class="n">quitAllowed</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨æœ‰å‚æ•°ç‰ˆæœ¬çš„ prepare æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼š</p>

<ol>
  <li>
    <p>ä¸€ä¸ªçº¿ç¨‹é‡Œè°ƒç”¨å¤šæ¬¡ Looper.prepare() ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæç¤º <code class="language-plaintext highlighter-rouge">Only one Looper may be created per thread</code>ï¼Œå³ <strong>ä¸€ä¸ªçº¿ç¨‹åªèƒ½åˆ›å»ºä¸€ä¸ª Looper</strong></p>
  </li>
  <li>
    <p>prepare é‡Œä¸»è¦å¹²çš„äº‹å°±æ˜¯ <code class="language-plaintext highlighter-rouge">sThreadLocal.set(new Looper(quitAllowed))</code></p>
  </li>
</ol>

<p>æºç é‡Œæ˜¯æ€ä¹ˆé™åˆ¶ä¸€ä¸ªçº¿ç¨‹åªèƒ½åˆ›å»ºä¸€ä¸ª Looper çš„å‘¢ï¼Ÿè°ƒç”¨å¤šæ¬¡ Looper.prepare() å¹¶ä¸ä¼šå…³è”å¤šä¸ª Looperï¼Œè¿˜ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£èƒ½ä¸èƒ½ç›´æ¥ new ä¸€ä¸ª Looper å…³è”ä¸Šå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸å¯ä»¥ï¼ŒLooper çš„æ„é€ æ–¹æ³•æ˜¯ private çš„ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nf">Looper</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">quitAllowed</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">mQueue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MessageQueue</span><span class="o">(</span><span class="n">quitAllowed</span><span class="o">);</span>
    <span class="n">mThread</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨æ¦‚è§ˆæ•´ä¸ª Looper çš„æ‰€æœ‰å…¬å¼€æ–¹æ³•åï¼Œå‘ç°åªæœ‰ prepare å’Œ prepareMainLooper æ˜¯åšçº¿ç¨‹ä¸ Looper å…³è”çš„å·¥ä½œçš„ï¼Œè€Œ prepareMainLooper æ˜¯ Android ç¯å¢ƒè°ƒç”¨çš„ï¼Œä¸æ˜¯ç”¨æ¥ç»™åº”ç”¨ä¸»åŠ¨è°ƒç”¨çš„ã€‚æ‰€ä»¥ä» Looper æºç é‡ŒæŒæ¡çš„ä¿¡æ¯æ¥çœ‹ï¼Œæƒ³ç»™ä¸€ä¸ªçº¿ç¨‹å…³è”å¤šä¸ª Looper çš„è·¯ä¸é€šã€‚</p>

<p>å¦å¤–æˆ‘ä»¬ä»æºç é‡Œèƒ½è§‚å¯Ÿåˆ°ï¼ŒLooper æœ‰ä¸€ä¸ª final çš„ mThread æˆå‘˜ï¼Œåœ¨æ„é€  Looper å¯¹è±¡çš„æ—¶å€™èµ‹å€¼ä¸º <code class="language-plaintext highlighter-rouge">Thread.currentThread()</code>ï¼Œæºç é‡Œå†æ— å¯ä»¥ä¿®æ”¹ mThread å€¼çš„åœ°æ–¹ï¼Œæ‰€ä»¥å¯çŸ¥ <strong>Looper åªèƒ½å…³è”åˆ°ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸”å…³è”ä¹‹åä¸èƒ½æ”¹å˜</strong>ã€‚</p>

<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿˜è®°å¾— Looper.prepare() é‡Œå¹²çš„ä¸»è¦äº‹æƒ…æ˜¯ <code class="language-plaintext highlighter-rouge">sThreadLocal.set(new Looper(quitAllowed))</code> å—ï¼Ÿä¸ä¹‹å¯¹åº”çš„ï¼Œè·å–æœ¬çº¿ç¨‹å…³è”çš„ Looper å¯¹è±¡æ˜¯ä½¿ç”¨é™æ€æ–¹æ³• Looper.myLooper()ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// sThreadLocal.get() will return null unless you've called prepare().</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">Looper</span><span class="o">&gt;</span> <span class="n">sThreadLocal</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">Looper</span><span class="o">&gt;();</span>

<span class="c1">// ...</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">quitAllowed</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Only one Looper may be created per thread"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="nc">Looper</span><span class="o">(</span><span class="n">quitAllowed</span><span class="o">));</span>
<span class="o">}</span>

<span class="c1">// ...</span>

<span class="cm">/**
 * Return the Looper object associated with the current thread.  Returns
 * null if the calling thread is not associated with a Looper.
 */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nd">@Nullable</span> <span class="nc">Looper</span> <span class="nf">myLooper</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä½¿ç”¨äº† ThreadLocal æ¥ç¡®ä¿ä¸åŒçš„çº¿ç¨‹è°ƒç”¨é™æ€æ–¹æ³• Looper.myLooper() è·å–åˆ°çš„æ˜¯ä¸å„è‡ªçº¿ç¨‹å…³è”çš„ Looper å¯¹è±¡ã€‚å…³äº ThreadLocalï¼Œåˆå¯ä»¥å¦å¼€ä¸€ä¸ªå°è¯é¢˜äº†ã€‚</p>

<p><strong>å°ç»“ï¼š</strong> Thread è‹¥ä¸ Looper å…³è”ï¼Œå°†ä¼šæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä¸”å…³è”åå…³ç³»æ— æ³•æ”¹å˜ã€‚</p>

<h3 id="looper-ä¸-messagequeue">Looper ä¸ MessageQueue</h3>

<p>ç›´æ¥æ¥çœ‹æºç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Looper</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="kd">final</span> <span class="nc">MessageQueue</span> <span class="n">mQueue</span><span class="o">;</span>

    <span class="c1">// ...</span>

    <span class="kd">private</span> <span class="nf">Looper</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">quitAllowed</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mQueue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MessageQueue</span><span class="o">(</span><span class="n">quitAllowed</span><span class="o">);</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Looper å¯¹è±¡é‡Œæœ‰ä¸€ä¸ª MessageQueue ç±»å‹æˆå‘˜ï¼Œåœ¨æ„é€ çš„æ—¶å€™ new å‡ºçš„ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ª finalï¼Œæ²¡æœ‰åœ°æ–¹èƒ½ä¿®æ”¹å®ƒçš„æŒ‡å‘ã€‚</p>

<p><strong>å°ç»“ï¼š</strong> Looper ä¸ MessageQueue æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚</p>

<h3 id="handler-ä¸-looper">Handler ä¸ Looper</h3>

<p>åœ¨å‰é¢ç•¥è¯» Looper æºç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç° Handler åŸºæœ¬æ²¡æœ‰å‡ºåœºï¼Œé‚£ä¹ˆç°åœ¨ï¼Œä»æ„é€  Handler çš„æ–¹æ³•å¼€å§‹åˆ†æã€‚</p>

<p>Handler çš„æ„é€ æ–¹æ³•æœ‰ 7 ä¸ªä¹‹å¤šï¼Œä¸è¿‡æœ‰ 3 ä¸ªæ ‡è®°ä¸º <code class="language-plaintext highlighter-rouge">@hide</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨çš„æœ‰ 4 ä¸ªï¼Œè¿™ 4 ä¸ªæœ€ç»ˆè°ƒç”¨éƒ½åˆ°äº†å…¶å®ƒçš„ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œæ¡å‡ºæ¥æˆ‘ä»¬è¦çœ‹çš„é‡ç‚¹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Handler</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    
    <span class="cm">/**
     * ...
     * @hide
     */</span>
    <span class="kd">public</span> <span class="nf">Handler</span><span class="o">(</span><span class="nc">Callback</span> <span class="n">callback</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">async</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="n">mLooper</span> <span class="o">=</span> <span class="nc">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mLooper</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span>
                    <span class="s">"Can't create handler inside thread that has not called Looper.prepare()"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">mQueue</span> <span class="o">=</span> <span class="n">mLooper</span><span class="o">.</span><span class="na">mQueue</span><span class="o">;</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>

    <span class="cm">/**
     * ...
     * @hide
     */</span>
    <span class="kd">public</span> <span class="nf">Handler</span><span class="o">(</span><span class="nc">Looper</span> <span class="n">looper</span><span class="o">,</span> <span class="nc">Callback</span> <span class="n">callback</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">async</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mLooper</span> <span class="o">=</span> <span class="n">looper</span><span class="o">;</span>
        <span class="n">mQueue</span> <span class="o">=</span> <span class="n">mLooper</span><span class="o">.</span><span class="na">mQueue</span><span class="o">;</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>

    <span class="c1">// ...</span>

    <span class="kd">final</span> <span class="nc">Looper</span> <span class="n">mLooper</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">MessageQueue</span> <span class="n">mQueue</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Handler å¯¹è±¡é‡Œæœ‰ final Looper æˆå‘˜ï¼Œæ‰€ä»¥ä¸€ä¸ª Handler åªä¼šå¯¹åº”ä¸€ä¸ªå›ºå®šçš„ Looper å¯¹è±¡ã€‚æ„é€  Handler å¯¹è±¡çš„æ—¶å€™å¦‚æœä¸ä¼  Looper å‚æ•°ï¼Œä¼šé»˜è®¤ä½¿ç”¨å½“å‰çº¿ç¨‹å…³è”çš„ Looperï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰å…³è” Looperï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>

<p>é‚£ä¹ˆèƒ½ä¸èƒ½ç»‘å®šå¤šä¸ª Handler åˆ°åŒä¸€ä¸ª Looper å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚åœ¨æºç é‡Œå¹¶æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„é™åˆ¶è¯´æ˜ï¼Œæ‰€ä»¥è¿™ç§é€‚åˆç”¨ä¸ªå° Demo æ¥éªŒè¯ï¼Œä¾‹å¦‚ä»¥ä¸‹ä¾‹å­ï¼Œå°±ç»‘å®šäº†ä¸¤ä¸ª Handler åˆ°ä¸»çº¿ç¨‹çš„ Looper ä¸Šï¼Œå¹¶éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼ˆæ—¥å¿— <code class="language-plaintext highlighter-rouge">receive msg: 1</code> å’Œ <code class="language-plaintext highlighter-rouge">receive msg: 2</code> èƒ½ä¾æ¬¡è¾“å‡ºï¼‰ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TAG</span> <span class="o">=</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>

    <span class="kd">private</span> <span class="nc">Handler</span> <span class="n">mHandler1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Handler</span> <span class="n">mHandler2</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Handler</span><span class="o">.</span><span class="na">Callback</span> <span class="n">mCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">.</span><span class="na">Callback</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"receive msg: "</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="na">what</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">mHandler1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">(</span><span class="n">mCallback</span><span class="o">);</span>
        <span class="n">mHandler2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">(</span><span class="n">mCallback</span><span class="o">);</span>

        <span class="n">mHandler1</span><span class="o">.</span><span class="na">sendEmptyMessage</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">mHandler2</span><span class="o">.</span><span class="na">sendEmptyMessage</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>å°ç»“ï¼š</strong> Handler ä¸ Looper æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œåˆ›å»º Handler å®ä¾‹æ—¶è¦ä¹ˆæä¾›ä¸€ä¸ª Looper å®ä¾‹ï¼Œè¦ä¹ˆå½“å‰çº¿ç¨‹æœ‰å…³è”çš„ Looperã€‚</p>

<h3 id="æ¶ˆæ¯å¦‚ä½•åˆ†å‘åˆ°å¯¹åº”çš„-handler">æ¶ˆæ¯å¦‚ä½•åˆ†å‘åˆ°å¯¹åº”çš„ Handler</h3>

<p>å› ä¸ºæ¶ˆæ¯çš„åˆ†å‘åœ¨æ˜¯ Looper.loop() è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªæ–¹æ³•ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">loop</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
        <span class="nc">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> <span class="c1">// might block</span>
        <span class="c1">// ...</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">msg</span><span class="o">.</span><span class="na">target</span><span class="o">.</span><span class="na">dispatchMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
            <span class="c1">// ...</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="c1">// ...</span>
        <span class="o">}</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¿™ä¸ªæ–¹æ³•é‡Œåšçš„ä¸»è¦å·¥ä½œæ˜¯ä» MessageQueue é‡Œä¾æ¬¡å–å‡º Messageï¼Œç„¶åè°ƒç”¨ Message.target.dispatchMessage æ–¹æ³•ï¼ŒMessage å¯¹è±¡çš„è¿™ä¸ª target æˆå‘˜æ˜¯ä»€ä¹ˆä¸œä¸œå‘¢ï¼Ÿå®ƒæ˜¯ä¸€ä¸ª Handlerï¼Œå®ƒæœ€ç»ˆä¼šè¢«è®¾ç½®æˆ sendMessage çš„ Handlerï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Handler</span> <span class="o">{</span>
    <span class="c1">// å…¶å®ƒ Handler.sendXXX æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">sendMessageAtTime</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">,</span> <span class="kt">long</span> <span class="n">uptimeMillis</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="nf">enqueueMessage</span><span class="o">(</span><span class="n">queue</span><span class="o">,</span> <span class="n">msg</span><span class="o">,</span> <span class="n">uptimeMillis</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// ...</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">enqueueMessage</span><span class="o">(</span><span class="nc">MessageQueue</span> <span class="n">queue</span><span class="o">,</span> <span class="nc">Message</span> <span class="n">msg</span><span class="o">,</span> <span class="kt">long</span> <span class="n">uptimeMillis</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">msg</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span> <span class="c1">// å°±æ˜¯è¿™é‡Œäº†</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æ‰€ä»¥æ˜¯ç”¨å“ªä¸ª Handler.sendMessageï¼Œæœ€ç»ˆå°±ä¼šè°ƒç”¨åˆ°å®ƒçš„ dispatchMessage æ–¹æ³•ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleCallback</span><span class="o">(</span><span class="nc">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">message</span><span class="o">.</span><span class="na">callback</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// ...</span>
<span class="cm">/**
 * Handle system messages here.
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispatchMessage</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">callback</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">handleCallback</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mCallback</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">mCallback</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">handleMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æ¶ˆæ¯åˆ†å‘åˆ°è¿™ä¸ªæ–¹æ³•ä»¥åï¼Œæ‰§è¡Œä¼˜å…ˆçº§åˆ†åˆ«æ˜¯ Message.callbackã€Handler.mCallbackï¼Œæœ€åæ‰æ˜¯ Handler.handleMesage æ–¹æ³•ã€‚</p>

<p><strong>å°ç»“ï¼š</strong> åœ¨ Handler.sendMessage æ—¶ï¼Œä¼šå°† Message.target è®¾ç½®ä¸ºè¯¥ Handler å¯¹è±¡ï¼Œè¿™æ ·ä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡º Message åï¼Œå°±èƒ½è°ƒç”¨åˆ°è¯¥ Handler çš„ dispatchMessage æ–¹æ³•æ¥è¿›è¡Œå¤„ç†ã€‚</p>

<h3 id="handler-èƒ½ç”¨äºçº¿ç¨‹åˆ‡æ¢çš„åŸç†">Handler èƒ½ç”¨äºçº¿ç¨‹åˆ‡æ¢çš„åŸç†</h3>

<p>å®é™…ä¸Šä¸€å°èŠ‚çš„ç»“è®ºå·²ç»è¿‘ä¹æ­ç¤ºäº†å…¶ä¸­çš„åŸç†ï¼Œè¿›ä¸€æ­¥è§£é‡Šä¸€ä¸‹å°±æ˜¯ï¼š</p>

<p><strong>å°ç»“ï¼š</strong> Handler ä¼šå¯¹åº”ä¸€ä¸ª Looper å’Œ MessageQueueï¼Œè€Œ Looper ä¸çº¿ç¨‹åˆä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥é€šè¿‡ Handler.sendXXX å’Œ Hanler.postXXX æ·»åŠ åˆ° MessageQueue çš„ Messageï¼Œä¼šåœ¨è¿™ä¸ªå¯¹åº”çš„çº¿ç¨‹çš„ Looper.loop() é‡Œå–å‡ºæ¥ï¼Œå¹¶å°±åœ°æ‰§è¡Œ Handler.dispatchMessageï¼Œè¿™å°±å¯ä»¥å®Œæˆçº¿ç¨‹åˆ‡æ¢äº†ã€‚</p>

<h3 id="runnable-ä¸-messagequeue">Runnable ä¸ MessageQueue</h3>

<p>Handler çš„ postXXX ç³»åˆ—æ–¹æ³•ç”¨äºè°ƒåº¦ Runnable å¯¹è±¡ï¼Œé‚£å®ƒæœ€åä¹Ÿæ˜¯å’Œ Message ä¸€æ ·è¢«åŠ åˆ° MessageQueue çš„å—ï¼Ÿå¯æ˜¯ MessageQueue æ˜¯ç”¨ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º Message çš„é“¾è¡¨æ¥ç»´æŠ¤æ¶ˆæ¯é˜Ÿåˆ—çš„ï¼Œç±»å‹ä¸åŒ¹é…ã€‚</p>

<p>åœ¨ Handler æºç é‡Œèƒ½æ‰¾åˆ°ç­”æ¡ˆï¼Œè¿™é‡Œå°±ä»¥ Handler.post(Runnable) æ–¹æ³•ä¸ºä¾‹ï¼Œå…¶å®ƒå‡ ä¸ª postXXX æ–¹æ³•æƒ…å½¢ä¸æ­¤ç±»ä¼¼ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Causes the Runnable r to be added to the message queue.
 * The runnable will be run on the thread to which this handler is 
 * attached. 
 *  
 * @param r The Runnable that will be executed.
 * 
 * @return Returns true if the Runnable was successfully placed in to the 
 *         message queue.  Returns false on failure, usually because the
 *         looper processing the message queue is exiting.
 */</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">post</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">return</span>  <span class="nf">sendMessageDelayed</span><span class="o">(</span><span class="n">getPostMessage</span><span class="o">(</span><span class="n">r</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// ...</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="nc">Message</span> <span class="nf">getPostMessage</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Message</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">Message</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
    <span class="n">m</span><span class="o">.</span><span class="na">callback</span> <span class="o">=</span> <span class="n">r</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°ï¼Œpost ç³»åˆ—æ–¹æ³•æœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨çš„ send ç³»åˆ—æ–¹æ³•ï¼ŒRunnable å¯¹è±¡æ˜¯è¢«å°è£…æˆ Message å¯¹è±¡ååŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ï¼ŒMessage.callback è¢«è®¾ç½®ä¸º Runnable æœ¬èº«ï¼Œè¿˜è®°å¾—å‰æ–‡ Handler.dispatchMessage çš„æ‰§è¡Œé¡ºåºå—ï¼Ÿå¦‚æœ Message.callback ä¸ä¸ºç©ºï¼Œåˆ™æ‰§è¡Œ Message.callback.run() åå°±è¿”å›ã€‚</p>

<p><strong>å°ç»“ï¼š</strong> Runnable è¢«å°è£…æˆ Message ä¹‹åæ·»åŠ åˆ° MessageQueueã€‚</p>

<h3 id="èƒ½å¦åˆ›å»ºå…³è”åˆ°å…¶å®ƒçº¿ç¨‹çš„-handler">èƒ½å¦åˆ›å»ºå…³è”åˆ°å…¶å®ƒçº¿ç¨‹çš„ Handler</h3>

<p>åˆ›å»º Handler æ—¶ä¼šå…³è”åˆ°ä¸€ä¸ª Looperï¼Œè€Œ Looper æ˜¯ä¸çº¿ç¨‹ä¸€ä¸€ç»‘å®šçš„ï¼Œæ‰€ä»¥ç†è®ºä¸Šè®²ï¼Œå¦‚æœèƒ½å¾—åˆ°è¦å…³è”çš„çº¿ç¨‹çš„ Looper å®ä¾‹ï¼Œè¿™æ˜¯å¯ä»¥å®ç°çš„ã€‚</p>

<p>åœ¨é˜…è¯» Looper æºç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ç•™æ„åˆ°ï¼ˆå¥½å§ï¼Œå…¶å®åº”è¯¥æ˜¯å¹³æ—¶å†™ä»£ç æ—¶æœ‰ç”¨åˆ°ï¼‰ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Looper</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Looper</span> <span class="n">sMainLooper</span><span class="o">;</span>  <span class="c1">// guarded by Looper.class</span>
    <span class="c1">// ...</span>
    <span class="cm">/**
     * Returns the application's main looper, which lives in the main thread of the application.
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Looper</span> <span class="nf">getMainLooper</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="nc">Looper</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">sMainLooper</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¯è§è·å–ä¸»çº¿ç¨‹çš„ Looper æ˜¯èƒ½å®ç°çš„ï¼Œå¹³æ—¶å†™ä»£ç è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦ä»å­çº¿ç¨‹å‘ä¸»çº¿ç¨‹æ·»åŠ ä¸€æ®µæ‰§è¡Œé€»è¾‘ï¼Œä¹Ÿç»å¸¸è¿™ä¹ˆå¹²ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ä»å­çº¿ç¨‹åˆ›å»ºå…³è”åˆ°ä¸»çº¿ç¨‹ Looper çš„ Handler</span>
<span class="nc">Handler</span> <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">(</span><span class="nc">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">());</span>

<span class="n">mHandler</span><span class="o">.</span><span class="na">post</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="o">});</span>
</code></pre></div></div>

<p>ä»å­çº¿ç¨‹åˆ›å»ºå…³è”åˆ°å…¶å®ƒå­çº¿ç¨‹çš„ Looper æ˜¯å¦å¯è¡Œå‘¢ï¼Ÿè¿™ä¸ªç”¨ Demo æ¥éªŒè¯ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">Thread</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setName</span><span class="o">(</span><span class="s">"thread-one"</span><span class="o">);</span>
        <span class="nc">Looper</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">Looper</span> <span class="n">threadOneLooper</span> <span class="o">=</span> <span class="nc">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">();</span>

        <span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">setName</span><span class="o">(</span><span class="s">"thread-two"</span><span class="o">);</span>
                <span class="nc">Handler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">(</span><span class="n">threadOneLooper</span><span class="o">);</span>

                <span class="n">handler</span><span class="o">.</span><span class="na">post</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
                        <span class="o">});</span>
            <span class="o">}</span>
        <span class="o">}.</span><span class="na">start</span><span class="o">();</span>

        <span class="nc">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}.</span><span class="na">start</span><span class="o">();</span>
</code></pre></div></div>

<p>æ‰§è¡Œåæ—¥å¿—è¾“å‡ºä¸º <code class="language-plaintext highlighter-rouge">thread-one</code>ã€‚</p>

<p><strong>å°ç»“ï¼š</strong> å¯ä»¥ä»ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå…³è”åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ Looper çš„ Handlerï¼Œåªè¦èƒ½æ‹¿åˆ°å¯¹åº”çº¿ç¨‹çš„ Looper å®ä¾‹ã€‚</p>

<h3 id="æ¶ˆæ¯å¯ä»¥æ’é˜Ÿå—">æ¶ˆæ¯å¯ä»¥æ’é˜Ÿå—</h3>

<p>è¿™ä¸ªé—®é¢˜ä»API æ–‡æ¡£ã€Handler æºç é‡Œéƒ½å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆï¼Œç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½¿ç”¨ Handler.sendMessageAtFrontOfQueue å’Œ Handler.postAtFrontOfQueue è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬ä¼šåˆ†åˆ«å°† Message å’Œ Runnableï¼ˆå°è£…åï¼‰æ’å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„é˜Ÿé¦–ã€‚</p>

<p>æˆ‘ç›®å‰å°šæœªé‡åˆ°è¿‡è¿™ç§ä½¿ç”¨åœºæ™¯ã€‚</p>

<p><strong>å°ç»“ï¼š</strong> æ¶ˆæ¯å¯ä»¥æ’é˜Ÿï¼Œä½¿ç”¨ Handler.xxxAtFrontOfQueue æ–¹æ³•ã€‚</p>

<h3 id="æ¶ˆæ¯å¯ä»¥æ’¤å›å—">æ¶ˆæ¯å¯ä»¥æ’¤å›å—</h3>

<p>åŒä¸Šï¼Œå¯ä»¥ä» Handler çš„ API æ–‡æ¡£ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚</p>

<p>å¯ä»¥ç”¨ Handler.hasXXX ç³»åˆ—æ–¹æ³•åˆ¤æ–­å…³è”çš„æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰ç­‰å¾…ä¸­çš„ç¬¦åˆæ¡ä»¶çš„ Message å’Œ Runnableï¼Œç”¨ Handler.removeXXX ç³»åˆ—æ–¹æ³•ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œç§»é™¤ç­‰å¾…ä¸­çš„ç¬¦åˆæ¡ä»¶çš„ Message å’Œ Runnableã€‚</p>

<p><strong>å°ç»“ï¼š</strong> å°šæœªåˆ†å‘çš„æ¶ˆæ¯æ˜¯å¯ä»¥æ’¤å›çš„ï¼Œå¤„ç†è¿‡çš„å°±æ²¡æ³•äº†ã€‚</p>

<h3 id="æ‰¾åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯æºç ">æ‰¾åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯æºç </h3>

<p>æˆ‘ä»¬å‰é¢æåˆ°è¿‡ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå°±æ˜¯ Looper.prepareMainLooper æ˜¯ Android ç¯å¢ƒè°ƒç”¨çš„ï¼Œè€Œä»è¯¥æ–¹æ³•çš„æ³¨é‡Šå¯çŸ¥ï¼Œè°ƒç”¨å®ƒå°±æ˜¯ä¸ºäº†åˆå§‹åŒ–ä¸»çº¿ç¨‹ Looperï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯è¿™éƒ¨åˆ†æºç ï¼Œæœç´¢ prepareMainLooper è¢«å“ªäº›åœ°æ–¹å¼•ç”¨å³å¯ã€‚</p>

<p>ä½¿ç”¨ insight.io æ’ä»¶çš„åŠŸèƒ½ï¼Œåœ¨ Looper.prepareMainLooper ä¸Šç‚¹ä¸€ä¸‹å³å¯çœ‹åˆ°å¼•ç”¨å¤„åˆ—è¡¨ï¼Œä¸€å…±ä¸¤å¤„ï¼š</p>

<p><img src="/images/posts/android/prepare-main-looper.png" alt="" /></p>

<p>ä»æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åä¸ŠçŒœæµ‹åº”è¯¥æ˜¯ç¬¬ä¸€å¤„ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ActivityThread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="nc">Looper</span><span class="o">.</span><span class="na">prepareMainLooper</span><span class="o">();</span>
        <span class="c1">// ...</span>
        <span class="nc">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å°±æ˜¯æˆ‘æƒ³è±¡ä¸­çš„æ¨¡æ ·ã€‚è¿™é‡Œåªæ˜¯ç®€å•æ‰¾åˆ°è¿™ä¸ªä½ç½®ï¼Œç»§ç»­æ·±å…¥æ¢ç´¢çš„è¯å¯ä»¥å¼€å¯ä¸€ä¸ªæ–°çš„è¯é¢˜äº†ï¼Œåç»­çš„ç¯‡ç« é‡Œå†è§£å†³ã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<h3 id="ç»“è®ºæ±‡æ€»">ç»“è®ºæ±‡æ€»</h3>

<ul>
  <li>
    <p>Thread è‹¥ä¸ Looper å…³è”ï¼Œå°†ä¼šæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä¸”å…³è”åå…³ç³»æ— æ³•æ”¹å˜ã€‚</p>
  </li>
  <li>
    <p>Looper ä¸ MessageQueue æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚</p>
  </li>
  <li>
    <p>Handler ä¸ Looper æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œåˆ›å»º Handler å®ä¾‹æ—¶è¦ä¹ˆæä¾›ä¸€ä¸ª Looper å®ä¾‹ï¼Œè¦ä¹ˆå½“å‰çº¿ç¨‹æœ‰å…³è”çš„ Looperã€‚</p>
  </li>
  <li>
    <p>åœ¨ Handler.sendMessage æ—¶ï¼Œä¼šå°† Message.target è®¾ç½®ä¸ºè¯¥ Handler å¯¹è±¡ï¼Œè¿™æ ·ä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡º Message åï¼Œå°±èƒ½è°ƒç”¨åˆ°è¯¥ Handler çš„ dispatchMessage æ–¹æ³•æ¥è¿›è¡Œå¤„ç†ã€‚</p>
  </li>
  <li>
    <p>Handler ä¼šå¯¹åº”ä¸€ä¸ª Looper å’Œ MessageQueueï¼Œè€Œ Looper ä¸çº¿ç¨‹åˆä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥é€šè¿‡ Handler.sendXXX å’Œ Hanler.postXXX æ·»åŠ åˆ° MessageQueue çš„ Messageï¼Œä¼šåœ¨è¿™ä¸ªå¯¹åº”çš„çº¿ç¨‹çš„ Looper.loop() é‡Œå–å‡ºæ¥ï¼Œå¹¶å°±åœ°æ‰§è¡Œ Handler.dispatchMessageï¼Œè¿™å°±å¯ä»¥å®Œæˆçº¿ç¨‹åˆ‡æ¢äº†ã€‚</p>
  </li>
  <li>
    <p>Runnable è¢«å°è£…æˆ Message ä¹‹åæ·»åŠ åˆ° MessageQueueã€‚</p>
  </li>
  <li>
    <p>å¯ä»¥ä»ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå…³è”åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ Looper çš„ Handlerï¼Œåªè¦èƒ½æ‹¿åˆ°å¯¹åº”çº¿ç¨‹çš„ Looper å®ä¾‹ã€‚</p>
  </li>
  <li>
    <p>æ¶ˆæ¯å¯ä»¥æ’é˜Ÿï¼Œä½¿ç”¨ Handler.xxxAtFrontOfQueue æ–¹æ³•ã€‚</p>
  </li>
  <li>
    <p>å°šæœªåˆ†å‘çš„æ¶ˆæ¯æ˜¯å¯ä»¥æ’¤å›çš„ï¼Œå¤„ç†è¿‡çš„å°±æ²¡æ³•äº†ã€‚</p>
  </li>
</ul>

<h3 id="é—ç•™çŸ¥è¯†ç‚¹">é—ç•™çŸ¥è¯†ç‚¹</h3>

<ol>
  <li>
    <p>ThreadLocal</p>
  </li>
  <li>
    <p>åº”ç”¨çš„å¯åŠ¨æµç¨‹</p>
  </li>
</ol>

<h3 id="æœ¬ç¯‡ç”¨åˆ°çš„æºç åˆ†ææ–¹æ³•">æœ¬ç¯‡ç”¨åˆ°çš„æºç åˆ†ææ–¹æ³•</h3>

<ol>
  <li>æ–‡æ¡£ä¼˜å…ˆ</li>
</ol>

<h2 id="åè¯">åè¯</h2>

<p>å…³äº Handlerã€Looper å’Œ MessageQueue çš„åˆ†æåœ¨æ­¤å…ˆå‘Šä¸€æ®µè½ï¼Œè¿™éƒ¨åˆ†çš„å†…å®¹æ¯”è¾ƒå®¹æ˜“åˆ†æï¼Œä½†é‡Œé¢ç»†èŠ‚æŒºå¤šçš„ï¼Œå†™å¾—æœ‰ç‚¹æ‚ä¸”ä¸å…¨ï¼Œæœ‰ç‚¹åªè§æ ‘æœ¨ä¸è§æ£®æ—çš„æ„Ÿè§‰ï¼Œæƒ³è¦é…åˆç”»ä¸€äº›å›¾ï¼Œä½†æ‰¾ä¸åˆ°åˆé€‚çš„ç”»å›¾å½¢å¼ã€‚å¯¹æ­¤ç±»ä¸»é¢˜çš„è§£ææ–¹å¼å¿…é¡»è¦å†æ¢ç´¢ä¼˜åŒ–ä¸€ä¸‹ï¼Œå¤§å®¶æœ‰å¥½çš„å»ºè®®è¯·ä¸€å®šå‘ŠçŸ¥ã€‚</p>

<hr />

<p>æœ€åï¼Œç…§ä¾‹è¦å®‰åˆ©ä¸€ä¸‹æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ã€Œé—·éªšçš„ç¨‹åºå‘˜ã€ï¼Œæ‰«ç å…³æ³¨ï¼Œæ¥æ”¶ rtfsc-android çš„æœ€è¿‘æ›´æ–°ã€‚</p>

<div align="center"><img width="192px" height="192px" src="https://mazhuang.org/assets/images/qrcode.jpg" /></div>

:ET